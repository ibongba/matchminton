<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="Description" content="Enter your description here" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/knowledge.css">
    <link rel="stylesheet" href="css/other.css">
    <title>BUY SALE</title>
</head>

<body>
    <div class="jumbotron jumbotron-fluid pt-4 mb-0" style="background-color: #000;">
        <div class="container-fluid p-0">
            <nav class="navbar navbar-expand-lg navbar-light bg-faded">
                <button class="navbar-toggler btn-left bg-light float-left" type="button" data-toggle="collapse" data-target="#navbarMobile" aria-controls="navbarMobile" aria-expanded="false" aria-label="Toggle navigation" id="navbarToggler">
              <span class="navbar-toggler-icon"></span>
                    </button>
                <div class="collapse navbar-collapse nav-fill w-100 ml-3" id="navbarMobile">
                    <div class="mx-auto headerLogo d-lg-none">
                        <a href="index.html" class="float-right w-100x  ">
                            <img src="images/LOGO_MATCHMINTON.png" alt="" class="w-100">
                        </a>
                    </div>
                    <!-- <div class="collapse "> -->
                    <ul class="nav navbar-nav nav-fill w-100">
                        <li class="nav-item">
                            <a class="nav-link" href="match.html">MATCHING</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="buySale.html">SHOP</a>
                        </li>
                    </ul>
                    <!-- </div> -->

                    <div class="mx-auto headerLogo d-none d-lg-block">
                        <a href="index.html" class="float-right w-100x  ">
                            <img src="images/LOGO_MATCHMINTON.png" alt="" class="w-100">
                        </a>
                    </div>

                    <!-- <div class="collapse navbar-collapse nav-fill w-100"> -->

                    <ul class="nav navbar-nav nav-fill w-100">
                        <li class="nav-item">
                            <a class="nav-link" href="webboard.html">COMMUNITY</a>
                        </li>
                        <!-- navbar ในส่วนที่ยังไม่ได้ login จะแสดง LOGIN  -->
                        <li class="nav-item" id="not-login">
                            <a class="nav-link" href="login.html">LOGIN</a>
                        </li>
                        <!-- </ul> 
                         <ul class="navbar-nav px-0"> 
                         <li class="nav-item">
                            <a href="createtheme.html"><button type="button" class="btn btn-info mx-2" data-toggle="modal" data-target="#exampleModal">ตั้งกระทู้</button></a>
                        </li> 
                         <li class="nav-item">
                            &nbsp;<a href="order.html"><i class="fas fa-shopping-cart"></i></a>
                        </li> -->
                        <!-- navbar ในส่วนที่ login  ยินดีต้อนรับ คุณ<span id="user_name"></span>  -->
                        <li class="nav-item" id="is-login">
                            <div class="dropdown">
                                <p class="dropdown-toggle mx-2" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="font-size: x-large; padding-top: 8px; font-weight: bold; color: #0AB2AC;">
                                    ยินดีต้อนรับ คุณ<span id="user_name"></span>
                                </p>
                                <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                                    <a class="dropdown-item" href="Editprofile.html"><i class="fas fa-cog"></i> แก้ไขโปรไฟล์</a>
                                    <a class="dropdown-item" onclick="logout()" href="#"><i class="fas fa-sign-out-alt"></i> ออกจากระบบ</a>
                                    <a class="dropdown-item" href="createtheme.html"><i class="fas fa-scroll"></i> ตั้งกระทู้</a>
                                    <a class="dropdown-item" href="order.html"><i class="fas fa-shopping-cart"></i> ตะกร้าสินค้า</a>
                                    <a class="dropdown-item" href="orderdetail.html"><i class="fas fa-file-invoice"></i> ประวัติการสั่งซื้อ</a>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
            </nav>
        </div>

        <div class="banner-img pt-2" style=" background-image: url(images/banner.PNG);">
            <div class="text-light text-right mx-5">
                <h2>MATCH FOR YOUR NOW!!</h2>
                <button type="button" class="btn btn-danger">PLAY NOW &nbsp;<i class="fas fa-caret-right"></i></button>
            </div>
        </div>
    </div>
    <div class="container">
        <div class="row my-4">
            <div class="col-md-4 mb-1">
                <select class="form-select btn-dark form-control w-100" aria-label="Default select example" onchange="onchangetype()" id="changeType">
                        <option value="">หมวดสินค้า</option>
                        <option value="1">ไม้แบดมินตัน</option>
                        <option value="2">รองเท้า</option>
                        <option value="3">เสื้อกีฬา</option>
                        <option value="4">กางเกงกีฬา</option>
                        <option value="5">กระเป๋า</option>
                        <option value="6">เอ็นแบดมินตัน</option>
                        <option value="7">กริ๊ปพันด้าม</option>
                    </select>
            </div>
            <div class="col-md-4 mb-1">
                <div class="input-group">
                    <input type="search" class="form-control btn-dark w-100" placeholder="SEARCH PRODUCT" id="searchproduct" onsearch="search(this)">
                </div>
                <!-- <button type="button" class="btn btn-dark form-control w-100">Search <i class="fas fa-search"></i></button> -->
            </div>
            <div class="col mb-1">
                <select class="form-select btn-dark form-control w-100" aria-label="Default select example" onchange="onchangePrice()" id="changePrice">
                        <option value="">เรียงตาม</option>
                        <option value="1">ความนิยม</option>
                        <option value="2">ราคาสูง</option>
                        <option value="3">ราคาต่ำ</option>
                      </select>
            </div>
        </div>
        <div class="row" id="result">
        </div>
    </div>
    <!-- container -->
    <footer>
        <div class=" container ">
            <div class="row">
                <div class="col-md-4">
                    <div class="text-center p-5">
                        <p class="text-uppercase">Lorem Ipsum simply dummy the printing typesettin industr Lorem Ipsum simply dummy the printing typesettin industr copy 2</p>

                    </div>
                </div>
                <div class="col-md-4">
                    <div class="text-center p-5">
                        <p class="text-uppercase">Lorem Ipsum simply dummy the printing typesettin industr Lorem Ipsum simply dummy the printing typesettin industr copy 2</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="text-center  p-5">
                        <p class="text-uppercase">Lorem Ipsum simply dummy the printing typesettin industr Lorem Ipsum simply dummy the printing typesettin industr copy 2</p>
                    </div>
                </div>
            </div>
            <p class="m-0" style="text-align: center; "><i class="far fa-copyright "></i>2020 MATCHMINTON. ALL RIGHTS RESERVED.</p>
        </div>
    </footer>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.1/umd/popper.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script>
        // swal("Good job!", "You Can Save!", "success");
    </script>
    <script>
        var user = JSON.parse(localStorage.getItem('user'));
        // console.log(user)
        if (user != null) {
            $('#user_name').text(user.name)
            $('#not-login').addClass('d-none')
            $('#is-login').removeClass('d-none')
        } else {
            $('#not-login').removeClass('d-none')
            $('#is-login').addClass('d-none')
        }

        logout = () => {
            localStorage.removeItem('user')
            $('#not-login').removeClass('d-none')
            $('#is-login').addClass('d-none')
        }


        function getSorted(selector, attrName) {
            return $($(selector).toArray().sort(function(a, b) {
                var aVal = parseInt(a.getAttribute(attrName)),
                    bVal = parseInt(b.getAttribute(attrName));
                return aVal - bVal;
            }));
        }

        $().ready((e) => {
            $.ajax({
                method: "POST",
                url: "service/product.php",
                data: {
                    action: 'show_product_card',
                    search: $('#searchproduct').val(),
                },
            }).done(function(msg) {
                // console.log(msg)
                msg = JSON.parse(msg)
                if (msg.code === 200) {
                    var res = msg.result;
                    for (i = 0; i < res.product.length; i++) {
                        let image = res.product_images.find((item) => res.product[i].product_id == item.fk_product_id);
                        $('#result').append(Card(res.product[i], image));
                    };
                    let test = getSorted('#result .product', 'data-order').clone()
                    $('#result').html(test);
                }
            });
        })

        function search(e) {
            $.ajax({
                method: "POST",
                url: "service/product.php",
                data: {
                    action: 'show_product_card',
                    search: $('#searchproduct').val(),
                }
            }).done(function(msg) {
                console.log(msg)
                msg = JSON.parse(msg)
                if (msg.code === 200) {
                    $('#result').empty();
                    var res = msg.result;
                    for (i = 0; i < res.product.length; i++) {
                        let image = res.product_images.find((item) => res.product[i].product_id == item.fk_product_id);
                        $('#result').append(Card(res.product[i], image));
                        $('#searchproduct').html('');
                        // $("#searchproduct").remove();
                    };
                }
            });
        }

        const onchangePrice = () => {
            $.ajax({
                method: 'POST',
                url: 'service/product.php',
                data: {
                    action: 'show_product_card_price',
                    price: $('#changePrice option:selected').val(),

                },
                dataType: 'json',
                // contentType: false,
                // processData: false,
            }).done(function(msg) {
                console.log(msg)
                    // msg = JSON.parse(msg);
                console.log(msg)
                if (msg.code === 200) {
                    $('#result').empty();
                    var res = msg.result;
                    for (i = 0; i < res.product.length; i++) {
                        let image = res.product_images.find((item) => res.product[i].product_id == item.fk_product_id);
                        $('#result').append(Card(res.product[i], image));

                    };
                }
            });
        }

        const onchangetype = () => {
            $.ajax({
                method: 'POST',
                url: 'service/product.php',
                data: {
                    action: 'show_product_card_type',
                    type: $('#changeType option:selected').val(),

                },
                dataType: 'json',
                // contentType: false,
                // processData: false,
            }).done(function(msg) {
                console.log(msg)
                    // msg = JSON.parse(msg);
                console.log(msg)
                if (msg.code === 200) {
                    $('#result').empty();
                    var res = msg.result;
                    for (i = 0; i < res.product.length; i++) {
                        let image = res.product_images.find((item) => res.product[i].product_id == item.fk_product_id);
                        $('#result').append(Card(res.product[i], image));

                    };
                }
            });
        }



        function currencyFormat(num) {
            return '฿' + num.toFixed(2).replace(/(\d)(?=(\d{3})+(?!\d))/g, '$1,')
        }


        Card = (item, image) => {
                var img = image ? 'service/' + image.path : 'https://via.placeholder.com/150';
                // if (item.price_show) {
                //     //  ${item.price_show = "0"? '<span>'+${currencyFormat(item.price_show*1)}+'</span>' : }
                // } else {

                // }
                if (isNaN(item.price_show)) {
                    item.price_show = '';
                }
                return `
            <div class="col-md-6 col-lg-4 product" data-order="${(user && item.flex == user.flex && item.balance == user.balance && item.weight_min <= user.weight && item.weight_max >= user.weight)? 1 : 2}">
                <div class="card" style="height: 550px">
                    ${(user && item.flex == user.flex && item.balance == user.balance && item.weight_min <= user.weight && item.weight_max >= user.weight) ?`<span class="position-absolute text-center p-1 w-100" style="background-color:red; color:#fff; left:0;">Recommend</span>`:``}
                    <div style="width: 327px; height: 327px;"> 
                        <img class="card-img-top w-100 h-100 " src="${img}" alt="Card image cap" >
                    </div>

                    <div class="card-body">
                        <h5 class="card-title">${item.product_name} </h5>
                       
                        
                        ${item.price_show == '0'? '<span>฿ '+item.price*1+'</span>': '<span>฿ '+item.price*1+'</span> <br> <span><del>฿ '+item.price_show*1+'</del></span>'}
                        <p class="card-text overflow-hidden" >${item.description}</p>
                        <div class="d-flex" style="justify-content: flex-end;">
                            <a onclick="InsestProduct(${item.product_id})" class="btn btn-light" ><i class="fas fa-shopping-cart"></i></a>
                        </div>
                        <div class="overlay">
                            <div class="text ">
                                <h3 class="p-4"><a href="productdetail.html?id=${item.product_id}" class="text-decoration-none m-4 text-light" >ดูรายละเอียดเพิ่มเติม</a></h3>
                            </div>
                        </div>
                    </div>
                </div> 
            </div>
            `;
        };

        function getUrlVars() {
            var vars = [],
                hash;
            var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
            for (var i = 0; i < hashes.length; i++) {
                hash = hashes[i].split('=');
                vars.push(hash[0]);
                vars[hash[0]] = hash[1];
            }
            return vars;
        }
       InsestProduct = (e) => {
            $.ajax({
                method: "POST",
                url: "service/insert_cart.php",
                data: {
                    user_id: user.user_id,
                    product_id: e ,
                },
            }).done(function(msg) {
                msg = JSON.parse(msg)
                console.log(msg)
                if (msg.code === 200) {
                    swal("Good job!", "You Can Save!", "success");
                  
                }else{
                    swal("Oops!", "Can not Save!", "error");
                }
                // $('#summernote').summernote('code', msg.result.content);

            });
        }
    </script>
</body>

</html>